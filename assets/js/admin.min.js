function loopIt(){video_batches=_.drop(video_batches),action_dataset.ids=video_batches[0],video_batches.length?editVideoLoop(action_dataset,video_batches,loopIt):($(".wpvr_manage_refresh:eq(0)").click(),$(".cutv_bulk_apply").attr("style","display: none !important;"),$(".wpvr_manage_bulk_actions_select").val(""),console.groupEnd())}function editVideoLoop(a,b,c){"publish"!=bulk_action&&(a.ids=editing_video_ids),_cutv.ajax(ajaxurl,a).then(function(d){console.groupCollapsed("result from "+a.action),console.info("[admin.js] edited "+a.ids.length+" video(s): "),console.groupCollapsed("full response: "+a.action),console.debug(d),console.groupEnd();var e=JSON.parse(d.split("data:")[1]);e.length?(console.debug(e),console.log("got videos that don't exist"),console.groupEnd(),"publish"!=bulk_action?(console.log("got videos that exist, need to delete them"),_cutv.ajax(ajaxurl,{action:"cutv_clear_snaptube_video",videos:e,status:bulk_action}).then(function(a){console.log("[finish bulk action after clearing]",a),finishBulkAction("cutv_clear_snaptube_video",a)})):editSnaptubeVideos(bulk_action,b[0],c)):(console.log("got videos that exist, videos have been updated, nothing more to do?"),loopIt()),$(".wpvr_manage_refresh:eq(0)").click()})}function getSelectedVideos(){var a=[];return $(".wpvr_video.checked").each(function(){var b=$(this).prop("id"),c=b.replace("video_","");a.push(Number(c))}),a}function editSnaptubeVideos(a,b,c){var d=[];if("publish"==a){$.Deferred();$.ajax({url:wpApiSettings.root+"cutv/v2/videos/?include="+_.join(b,","),success:function(a){d=[],_.forEach(b,function(b,c){var e=_.find(a[c],{id:b}),f=$("#video_"+e.id),g=f.find(".wpvr_video_thumb img").attr("src"),h="http://www.youtube.com/watch?v="+f.find('[post_id="'+e.id+'"]').attr("video_id"),i=e.content.rendered;d.push({categories:e.categories,description:i.replace(/<\/?[^>]+(>|$)/g,""),name:f.find(".wpvr_video_title").text(),file:h,slug:e.slug,tags:e.tags,duration:f.find(".wpvr_video_duration").text(),image:g,opimage:g.replace("-200x150",""),post_date:moment(e.date).format("YYYY-MM-DD HH:mm:ss"),link:h,member_id:e.author,id:e.id})}),d=_.compact(d),_cutv.ajax(ajaxurl,{action:"cutv_convert_snaptube",videos:d}).then(function(a){finishBulkAction("cutv_convert_snaptube",a),c()})}})}}function finishBulkAction(a,b){$(".wpvr_manage_refresh:eq(0)").click(),$(".cutv_bulk_apply").attr("style","display: none !important;"),$(".wpvr_manage_bulk_actions_select").val(""),console.groupCollapsed("full response: "+a),console.debug(b),console.groupEnd()}function MakePromise(a){var b={method:"POST",cache:!0,showErrors:!0,success:function(a){c.resolve(a)},error:function(a,b,d){400==a.status?(errorMessage=a.responseText,log({msg:"%c(╯°□°）╯ should be accompanied by custom message to display",color:"red"}),log({msg:errorMessage,color:"red"})):(log({msg:"%c(╯°□°）╯",color:"red"}),errorMessage={error:a.message,statusCode:a.code}),c.reject(errorMessage)}};$.extend(b,a.options);var c=$.Deferred();return $.ajax({type:b.method,url:a.url,data:a.data,success:b.success,error:b.error,beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}}),c}function log(a){var b={msg:null,level:DEBUG_LEVEL,group:!1,color:"blue"};$.extend(b,a),DEBUG_LEVEL>2&&"Microsoft Internet Explorer"!=navigator.appName&&console.log("%c"+a.msg,"color:"+a.color+";")}var $=jQuery,_tempData,editing_video_ids,bulk_action,action_dataset,video_batches;jQuery(function(a){var b='<div class="cutv_bulk_apply pull-left"><button class="ui labeled icon button"><i class="add circle icon"></i>Apply to  <span class="wpvr_count_checked"></span> videos</button></div>';a(".wpvr_manage_bulk_actions").append(b),a("body").on("change",".wpvr_manage_bulk_actions_select",function(){switch(bulk_action=a(this).val()){case"publish":case"pending":case"untrash":case"trash":case"draft":action_dataset={action:"cutv_set_wpvr_videos_status",ids:getSelectedVideos(),status:bulk_action},a(".wpvr_manage_bulkApply").attr("style","display: none !important;"),a(".cutv_bulk_apply").attr("style","display: block !important;");break;default:console.log("default action chosen: ",bulk_action),a(".wpvr_manage_bulkApply").attr("style","display: block !important;"),a(".cutv_bulk_apply").attr("style","display: none !important;")}}).on("click",".cutv_bulk_apply",function(a){a.preventDefault(),editing_video_ids=getSelectedVideos(),video_batches=_.chunk(editing_video_ids,10),action_dataset.ids=video_batches[0],editVideoLoop(action_dataset,video_batches,loopIt)}).on("click","#add-category-button",function(){var b=a('[name="cutv-new-channel-name"]').val(),c=b.toLowerCase();c=c.replace(/ /g,"-"),_cutv.ajax(wpApiSettings.root+"cutv/v2/categories",{description:"Mlkshk flannel deep v marfa hashtag brooklyn.",name:b,slug:c},{method:"POST"}).then(function(a){console.log(a),_cutv.ajax(ajaxurl,{action:"cutv_add_channel",channelName:a.name,slug:a.slug,description:a.description,cat_id:a.id}).then(function(a){})})}).on("submit",".source-form",function(b){b.preventDefault();var c=a(this),d=a(this).serializeArray(),e=[];_.forEach(d,function(a){var b=Number(a.name);_.isNaN(b)||e.push(a.name)});var f=[];a.each(c.find('.assigned [type="checkbox"]:not(:checked)'),function(){f.push(a(this).prop("name"))}),_cutv.ajax("/wp-admin/admin-ajax.php",{action:"cutv_update_source_categories",sources:e,channel:Number(c.find('[name="channel_id"]').val()),removing_sources:f,source_count:Number(c.find(".item.assigned").length)}).then(function(a){console.log(a)})})}).ajaxSuccess(function(a,b,c){var d,e=c.url;e.search("bulk_single_action")>0&&(console.log("URL: "+e),d=b.responseText),jQuery(".cutv_bulk_apply, .wpvr_manage_bulkApply").attr("style","display: none !important;"),jQuery(".wpvr_manage_bulk_actions_select").val("").hide()});var _cutv={ajax:function(a,b,c){return new MakePromise({url:a,data:b,options:c})}};DEBUG_LEVEL="cutv.dev"==window.location.hostname?3:0,"Microsoft Internet Explorer"==navigator.appName&&(DEBUG_LEVEL=0);